<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenExpert Pro | Mastery Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --accent: #fbbf24;
            --accent-glow: rgba(251, 191, 36, 0.4);
            --bg-deep: #020617;
        }

        body { background-color: var(--bg-deep); color: #f8fafc; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-hover:hover { background: rgba(30, 41, 59, 0.9); border-color: var(--accent); }
        .text-neon { text-shadow: 0 0 15px var(--accent-glow); }
        
        .progression-pill { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .active-pill { background: var(--accent); box-shadow: 0 0 20px var(--accent); transform: scale(1.2); }

        .streak-badge {
            animation: pulse-gold 2s infinite;
        }

        @keyframes pulse-gold {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in { animation: slideInUp 0.5s ease-out forwards; }

        .gen-checkbox:checked + label { 
            background: var(--accent); 
            color: #020617; 
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        .difficulty-indicator {
            height: 4px;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="font-sans antialiased">

    <!-- NAVIGATION -->
    <nav class="sticky top-0 z-50 border-b border-white/5 bg-slate-950/90 backdrop-blur-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="app.switchTab('home')">
                <div class="w-10 h-10 bg-amber-400 rounded-xl flex items-center justify-center text-slate-950 font-black text-xl shadow-lg shadow-amber-400/20">G</div>
                <span class="text-2xl font-black tracking-tighter text-white">GEN<span class="text-amber-400">EXPERT</span> <span class="text-[10px] bg-white/10 px-2 py-0.5 rounded ml-1 text-slate-400 tracking-normal uppercase">Pro</span></span>
            </div>
            <div class="flex gap-4">
                <button onclick="app.switchTab('explore')" class="text-sm font-bold text-slate-400 hover:text-white transition-colors">Archive</button>
                <button onclick="app.switchTab('quiz')" class="px-6 py-2 bg-white text-slate-950 rounded-xl text-sm font-black hover:bg-amber-400 transition-all hover:shadow-lg">Training</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- HOME VIEW -->
        <section id="view-home" class="py-24 text-center animate-in">
            <div class="mb-6 inline-flex items-center gap-2 px-3 py-1 rounded-full bg-amber-400/10 border border-amber-400/20 text-amber-400 text-[10px] font-black uppercase tracking-[0.2em]">
                <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-amber-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-amber-400"></span></span>
                System v2.5 Online
            </div>
            <h1 class="text-6xl md:text-8xl font-black mb-8 tracking-tighter leading-[0.9]">Unlock Your <br><span class="text-amber-400 text-neon">Generational Knowledge.</span></h1>
            <p class="text-slate-400 text-xl max-w-2xl mx-auto mb-12 leading-relaxed">
                Adaptive psychographic assessment engine. Track your mastery across the 1883-2025 timeline with real-time performance analytics.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="app.switchTab('explore')" class="px-10 py-5 glass glass-hover rounded-2xl font-bold text-lg transition-all">Historical Library</button>
                <button onclick="app.switchTab('quiz')" class="px-10 py-5 bg-amber-400 text-slate-950 rounded-2xl font-black text-lg shadow-2xl shadow-amber-400/30 hover:scale-105 transition-all">Launch Training</button>
            </div>
        </section>

        <!-- EXPLORE VIEW -->
        <section id="view-explore" class="hidden animate-in space-y-8">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-3 space-y-8">
                    <div class="glass p-8 rounded-[2.5rem] border-white/5">
                        <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
                            <span class="w-1.5 h-6 bg-amber-400 rounded-full"></span> Timeline Matrix
                        </h3>
                        <div class="h-80">
                            <canvas id="timelineChart"></canvas>
                        </div>
                    </div>
                    <div id="gen-detail" class="glass p-10 rounded-[2.5rem] min-h-[450px] border-white/5 relative overflow-hidden">
                        <!-- Detail JS -->
                    </div>
                </div>
                <div class="space-y-3 max-h-[850px] overflow-y-auto pr-2 hide-scroll" id="gen-list">
                    <!-- List JS -->
                </div>
            </div>
        </section>

        <!-- QUIZ VIEW -->
        <section id="view-quiz" class="hidden animate-in">
            <div class="max-w-4xl mx-auto">
                
                <!-- SETUP -->
                <div id="quiz-setup" class="glass p-12 rounded-[3rem] border-white/5">
                    <div class="text-center mb-10">
                        <h2 class="text-4xl font-black mb-3">Initialize Assessment</h2>
                        <p class="text-slate-500">Choose focus areas for your 15-question deep dive.</p>
                    </div>
                    
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-12" id="focus-options">
                        <!-- JS Focus -->
                    </div>

                    <div class="bg-white/5 rounded-2xl p-6 mb-10 flex flex-wrap gap-8 justify-center items-center">
                        <div class="text-center">
                            <span class="block text-[10px] text-slate-500 font-black uppercase mb-1">Duration</span>
                            <span class="text-xl font-bold">15 Rounds</span>
                        </div>
                        <div class="w-px h-10 bg-white/10"></div>
                        <div class="text-center">
                            <span class="block text-[10px] text-slate-500 font-black uppercase mb-1">Scoring</span>
                            <span class="text-xl font-bold">Scaling Multiplier</span>
                        </div>
                        <div class="w-px h-10 bg-white/10"></div>
                        <div class="text-center">
                            <span class="block text-[10px] text-slate-500 font-black uppercase mb-1">Mode</span>
                            <span class="text-xl font-bold">Focused Study</span>
                        </div>
                    </div>

                    <div class="flex flex-col items-center">
                        <button onclick="app.startQuiz()" class="group relative bg-amber-400 text-slate-950 px-16 py-5 rounded-2xl font-black text-xl hover:scale-105 transition-all shadow-xl shadow-amber-400/20">
                            Begin 15-Question Mission
                        </button>
                    </div>
                </div>

                <!-- HUD -->
                <div id="quiz-hud" class="hidden space-y-4 mb-6">
                    <div class="grid grid-cols-3 gap-4">
                        <div class="glass p-5 rounded-3xl flex flex-col items-center border-white/5">
                            <span class="text-[10px] uppercase text-slate-500 font-black tracking-widest mb-1">Level</span>
                            <div class="flex gap-1.5" id="difficulty-pills">
                                <div class="w-3 h-3 rounded-full bg-slate-800 progression-pill" id="pill-0"></div>
                                <div class="w-3 h-3 rounded-full bg-slate-800 progression-pill" id="pill-1"></div>
                                <div class="w-3 h-3 rounded-full bg-slate-800 progression-pill" id="pill-2"></div>
                                <div class="w-3 h-3 rounded-full bg-slate-800 progression-pill" id="pill-3"></div>
                            </div>
                        </div>
                        <div class="glass p-5 rounded-3xl flex flex-col items-center border-white/5 relative overflow-hidden">
                            <span class="text-[10px] uppercase text-slate-500 font-black tracking-widest mb-1">Credits</span>
                            <span class="text-2xl font-black text-amber-400 text-neon" id="current-score">0</span>
                            <div id="streak-counter" class="hidden absolute top-2 right-4 px-2 py-0.5 rounded bg-amber-400 text-slate-950 text-[10px] font-black">STREAK x2</div>
                        </div>
                        <div class="glass p-5 rounded-3xl flex flex-col items-center border-white/5">
                            <span class="text-[10px] uppercase text-slate-500 font-black tracking-widest mb-1">Progress</span>
                            <span class="text-xl font-bold" id="q-status">1 / 15</span>
                        </div>
                    </div>
                    <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                        <div id="progress-bar-inner" class="h-full bg-amber-400 transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>

                <!-- PLAY -->
                <div id="quiz-play" class="hidden space-y-6">
                    <div class="glass p-12 rounded-[3.5rem] border-white/10 shadow-2xl">
                        <div id="difficulty-badge" class="mb-6 inline-block px-3 py-1 rounded-lg bg-white/5 text-[10px] font-bold text-slate-400 uppercase tracking-widest">General Knowledge</div>
                        <h2 id="q-text" class="text-3xl md:text-4xl font-black leading-tight mb-12">Generating context...</h2>
                        <div id="q-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Options -->
                        </div>
                    </div>

                    <div id="q-feedback" class="hidden glass p-10 rounded-[2.5rem] animate-in">
                        <div class="flex flex-col md:flex-row gap-8 items-center md:items-start">
                            <div id="fb-icon" class="text-6xl p-4 bg-white/5 rounded-3xl"></div>
                            <div class="flex-1">
                                <h4 id="fb-title" class="text-2xl font-black mb-3 uppercase tracking-tight"></h4>
                                <p id="fb-desc" class="text-slate-400 text-lg mb-8 leading-relaxed"></p>
                                <button onclick="app.nextQuestion()" class="bg-amber-400 text-slate-950 px-12 py-4 rounded-2xl font-black text-lg hover:bg-white transition-all">Advance Sequence</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DASHBOARD -->
                <div id="quiz-dashboard" class="hidden space-y-8 animate-in">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 glass p-10 rounded-[3rem] border-amber-400/20 shadow-xl shadow-amber-400/5">
                            <h3 class="text-2xl font-black mb-8">System Report</h3>
                            <div class="space-y-8">
                                <div>
                                    <p class="text-slate-500 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Total Points</p>
                                    <p class="text-7xl font-black text-amber-400 text-neon leading-none" id="dash-score">0</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4 pt-6 border-t border-white/5">
                                    <div>
                                        <p class="text-slate-500 text-[10px] font-black uppercase mb-1">Accuracy</p>
                                        <p class="text-2xl font-bold" id="dash-accuracy">0%</p>
                                    </div>
                                    <div>
                                        <p class="text-slate-500 text-[10px] font-black uppercase mb-1">Max Streak</p>
                                        <p class="text-2xl font-bold text-amber-400" id="dash-streak">0</p>
                                    </div>
                                </div>
                            </div>
                            <button onclick="app.switchTab('quiz')" class="mt-12 w-full py-5 bg-white text-slate-950 rounded-2xl font-black text-lg hover:bg-amber-400 transition-all">Recalibrate Parameters</button>
                        </div>
                        <div class="lg:col-span-2 glass p-10 rounded-[3rem] border-white/5 flex flex-col">
                            <h3 class="text-xl font-bold mb-8 flex items-center gap-3">
                                <span class="w-1.5 h-6 bg-indigo-500 rounded-full shadow-[0_0_10px_rgba(99,102,241,0.5)]"></span> Mastery Distribution
                            </h3>
                            <div class="flex-1 min-h-[300px]">
                                <canvas id="masteryChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="glass p-10 rounded-[3rem] border-white/5">
                        <div class="flex justify-between items-center mb-10">
                            <h3 class="text-2xl font-black">Historical Debriefing</h3>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-green-500/10 text-green-500 rounded text-[10px] font-bold uppercase">Passed</span>
                                <span class="px-3 py-1 bg-red-500/10 text-red-500 rounded text-[10px] font-bold uppercase">Corrected</span>
                            </div>
                        </div>
                        <div id="review-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Review List -->
                        </div>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        // --- EXPANDED DATASET (45+ Questions for zero repetition) ---
        const gens = [
            { id: 'lost', name: 'Lost Gen', start: 1883, end: 1900, icon: 'ðŸŽ©', color: '#f59e0b' },
            { id: 'greatest', name: 'Greatest Gen', start: 1901, end: 1927, icon: 'ðŸŽ–ï¸', color: '#10b981' },
            { id: 'silent', name: 'Silent Gen', start: 1928, end: 1945, icon: 'ðŸ“»', color: '#6366f1' },
            { id: 'boomers', name: 'Baby Boomers', start: 1946, end: 1964, icon: 'â˜®ï¸', color: '#ec4899' },
            { id: 'genx', name: 'Gen X', start: 1965, end: 1980, icon: 'ðŸ“¼', color: '#f43f5e' },
            { id: 'millennials', name: 'Millennials', start: 1981, end: 1996, icon: 'ðŸ’¾', color: '#8b5cf6' },
            { id: 'genz', name: 'Gen Z', start: 1997, end: 2012, icon: 'ðŸ“±', color: '#06b6d4' },
            { id: 'alpha', name: 'Gen Alpha', start: 2013, end: 2025, icon: 'ðŸ¤–', color: '#14b8a6' }
        ];

        const questions = [
            // LEVEL 0 (100 pts)
            { q: "Which gen is famously nicknamed 'The Latchkey Kids'?", options: ["Boomers", "Gen X", "Millennials", "Gen Z"], correct: 1, diff: 0, gen: 'genx', exp: "Gen X grew up with high rates of dual-income households, often coming home to empty houses." },
            { q: "What defines the start of the Baby Boomer generation?", options: ["The Cold War", "WWII birth spike", "The Internet", "TV's invention"], correct: 1, diff: 0, gen: 'boomers', exp: "The 'Boom' refers to the explosion of births following WWII." },
            { q: "Gen Z is often categorized as the first 'Mobile-First' generation. True?", options: ["True", "False"], correct: 0, diff: 0, gen: 'genz', exp: "Gen Z grew up with smartphones as their primary device for social interaction." },
            { q: "Which group served as the bulk of the workforce during the Great Depression?", options: ["Lost", "Greatest", "Silent", "Boomers"], correct: 1, diff: 0, gen: 'greatest', exp: "The Greatest Generation built their resilience through the hardships of the 1930s." },
            { q: "Gen Alpha children are primarily the kids of which generation?", options: ["Gen X", "Millennials", "Gen Z", "Silent"], correct: 1, diff: 0, gen: 'alpha', exp: "Gen Alpha (2013+) are largely the offspring of Millennials." },
            { q: "The 'Silent Generation' was born between which major global conflicts?", options: ["Civil & WWI", "WWI & WWII", "WWII & Vietnam", "Vietnam & Gulf"], correct: 1, diff: 0, gen: 'silent', exp: "They were born 1928-1945, missing the combat of both world wars." },
            { q: "Which gen is associated with the 'Disillusionment' after World War I?", options: ["Greatest", "Silent", "Lost", "Boomers"], correct: 2, diff: 0, gen: 'lost', exp: "The 'Lost' moniker describes the trauma and cultural aimlessness post-1918." },
            { q: "Which generation is currently the largest living adult cohort in the US?", options: ["Boomers", "Gen X", "Millennials", "Gen Z"], correct: 2, diff: 0, gen: 'millennials', exp: "Millennials overtook Boomers as the largest living adult generation in 2019." },

            // LEVEL 1 (150 pts)
            { q: "Which year marks the transition from Millennial to Gen Z (Pew standard)?", options: ["1994", "1996", "1998", "2000"], correct: 1, diff: 1, gen: 'millennials', exp: "1996 is the standard cutoff separating those who remember 9/11 from those who don't." },
            { q: "Who coined the phrase 'The Greatest Generation' in 1998?", options: ["Tom Brokaw", "Cronkite", "Bill Clinton", "Spielberg"], correct: 0, diff: 1, gen: 'greatest', exp: "Journalist Tom Brokaw wrote the best-selling book of that name." },
            { q: "Which movement is most culturally linked to the Boomer youth of 1969?", options: ["Grunge", "Disco", "Woodstock/Hippie", "Punk"], correct: 2, diff: 1, gen: 'boomers', exp: "Woodstock was the defining cultural peak for Boomer idealists." },
            { q: "Gen X is often credited with starting which tech revolution?", options: ["The iPhone", "The Personal Computer", "Radio", "Cable News"], correct: 1, diff: 1, gen: 'genx', exp: "Gen X icons like Steve Jobs and Bill Gates drove the personal computing boom." },
            { q: "The 'Beat Generation' writers mostly belonged to which birth cohort?", options: ["Greatest", "Silent", "Boomers", "Lost"], correct: 1, diff: 1, gen: 'silent', exp: "Kerouac, Ginsberg, and Burroughs were mostly Silent Generation members." },
            { q: "Which gen is statistically the most racially diverse in history?", options: ["Millennials", "Gen Z", "Gen X", "Alpha"], correct: 1, diff: 1, gen: 'genz', exp: "Gen Z's diversity metrics far exceed previous generations." },
            { q: "What is the primary tech interface defining Gen Alpha's infancy?", options: ["Keyboard", "Touchscreen", "Voice UI / AI", "Remote Control"], correct: 2, diff: 1, gen: 'alpha', exp: "Voice assistants and AI are native to Gen Alpha from birth." },
            { q: "The term 'Generation X' was popularized by which 1991 novel?", options: ["American Psycho", "Generation X", "Fight Club", "Microserfs"], correct: 1, diff: 1, gen: 'genx', exp: "Douglas Coupland's novel 'Generation X' gave the group its name." },

            // LEVEL 2 (200 pts)
            { q: "In the 1970s, Baby Boomers were criticized as being the '___ Generation'.", options: ["Lost", "Me", "Greedy", "Silent"], correct: 1, diff: 2, gen: 'boomers', exp: "The 'Me' Generation reflected a focus on self-actualization over community." },
            { q: "Which generation saw the largest increase in higher education degrees?", options: ["Boomers", "Gen X", "Millennials", "Silent"], correct: 2, diff: 2, gen: 'millennials', exp: "Millennials became the most educated cohort in Western history up to that point." },
            { q: "Which cohort is often called the 'Sandwich Generation' today?", options: ["Boomers", "Gen X", "Gen Z", "Silent"], correct: 1, diff: 2, gen: 'genx', exp: "Many Gen Xers are simultaneously raising children and caring for aging Boomer parents." },
            { q: "What event in 1929 fundamentally shaped the childhood of the Silent Gen?", options: ["WWII", "Dust Bowl", "Stock Market Crash", "Prohibition"], correct: 2, diff: 2, gen: 'silent', exp: "The Great Depression formed the financial caution common in the Silent Generation." },
            { q: "Who were the 'G.I. Generation' before being renamed 'Greatest'?", options: ["Civil War vets", "WWI soldiers", "WWII soldiers", "Vietnam vets"], correct: 2, diff: 2, gen: 'greatest', exp: "They were called the G.I. (Government Issue) Generation for decades." },
            { q: "The 'MTV Generation' is a classic synonym for which group?", options: ["Early Boomers", "Late Gen X", "Millennials", "Gen Z"], correct: 1, diff: 2, gen: 'genx', exp: "Gen X's youth was defined by the launch and peak of MTV in the 80s." },
            { q: "Which gen holds the highest percentage of global 'Wealth-to-Population' ratio?", options: ["Millennials", "Silent", "Boomers", "Gen Z"], correct: 2, diff: 2, gen: 'boomers', exp: "Baby Boomers control over 50% of US household wealth currently." },
            { q: "Which generation is expected to reach 2 billion members by 2025?", options: ["Gen Z", "Millennials", "Gen Alpha", "Boomers"], correct: 2, diff: 2, gen: 'alpha', exp: "Alpha is on track to be the largest generation in global history." },

            // LEVEL 3 (300 pts)
            { q: "Who first said 'You are all a lost generation' to Ernest Hemingway?", options: ["James Joyce", "Gertrude Stein", "Scott Fitzgerald", "Sylvia Beach"], correct: 1, diff: 3, gen: 'lost', exp: "Gertrude Stein famously said this in Paris during the 1920s." },
            { q: "Which sociologist first proposed the 'Strauss-Howe' generational theory?", options: ["Karl Marx", "William Strauss", "Max Weber", "Malcolm Gladwell"], correct: 1, diff: 3, gen: 'silent', exp: "William Strauss and Neil Howe developed the 'Four Turnings' theory." },
            { q: "Which year is considered the definitive 'Pulse Year' for Gen X?", options: ["1965", "1970", "1973", "1976"], correct: 2, diff: 3, gen: 'genx', exp: "1973 is often cited as the 'core' birth year for the generation's psychographics." },
            { q: "The 'Silent Generation' is the only cohort in 100 years not to produce a...?", options: ["President (US)", "Billionaire", "Nobel Prize", "Astronaut"], correct: 0, diff: 3, gen: 'silent', exp: "No US President (so far) has come from the Silent Generation (Biden/Trump are Boomer/Silent cusp)." },
            { q: "Which exact event is used to define the 'Echo Boomer' moniker?", options: ["Birth rates 1980-95", "The 1964 peak", "The dot-com crash", "Vietnam exit"], correct: 0, diff: 3, gen: 'millennials', exp: "They are the 'echo' of their parents' massive birth wave." },
            { q: "Gen Z is the first generation to have a majority favor which social shift?", options: ["Remote Work", "Home Ownership", "Gig Economy", "Gender Fluidity"], correct: 3, diff: 3, gen: 'genz', exp: "Gen Z marks a massive shift in cultural views on gender and identity." },
            { q: "The 'Alpha' name was chosen by researcher Mark McCrindle after which event?", options: ["The 2008 Crash", "Launch of iPad (2010)", "COVID-19", "Facebook launch"], correct: 1, diff: 3, gen: 'alpha', exp: "The 2010 iPad launch is often seen as the technological starting line for Alpha." },
            { q: "Which cohort is most associated with the 'Disruptive Innovation' era?", options: ["Boomers", "Gen X", "Millennials", "Gen Z"], correct: 2, diff: 3, gen: 'millennials', exp: "Millennials matured alongside the rise of Uber, Airbnb, and the gig economy." }
        ];

        const app = {
            state: {
                tab: 'home',
                quiz: {
                    active: false, score: 0, history: [],
                    currentDiff: 0, qIdx: 0, total: 15,
                    usedIds: [], mastery: {}, focus: [],
                    streak: 0, maxStreak: 0
                },
                charts: { timeline: null, mastery: null }
            },

            init() {
                this.renderGenList();
                this.renderFocusOptions();
                this.initTimeline();
            },

            switchTab(tabId) {
                ['view-home', 'view-explore', 'view-quiz'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.getElementById(`view-${tabId}`).classList.remove('hidden');
                if(tabId === 'quiz' && !this.state.quiz.active) {
                    document.getElementById('quiz-setup').classList.remove('hidden');
                    document.getElementById('quiz-play').classList.add('hidden');
                    document.getElementById('quiz-hud').classList.add('hidden');
                    document.getElementById('quiz-dashboard').classList.add('hidden');
                }
                window.scrollTo(0,0);
            },

            renderFocusOptions() {
                const container = document.getElementById('focus-options');
                container.innerHTML = gens.map(g => `
                    <div class="relative">
                        <input type="checkbox" id="focus-${g.id}" value="${g.id}" class="hidden gen-checkbox" checked>
                        <label for="focus-${g.id}" class="block p-4 rounded-2xl border border-white/5 glass-hover cursor-pointer text-[10px] font-black uppercase tracking-widest transition-all text-center">
                            ${g.name}
                        </label>
                    </div>
                `).join('');
            },

            renderGenList() {
                const list = document.getElementById('gen-list');
                list.innerHTML = gens.map(g => `
                    <button onclick="app.showDossier('${g.id}')" class="w-full text-left p-6 rounded-3xl glass glass-hover transition-all flex items-center gap-5 border-white/5">
                        <span class="text-4xl filter drop-shadow-md">${g.icon}</span>
                        <div>
                            <div class="font-black text-white text-lg leading-tight">${g.name}</div>
                            <div class="text-[10px] text-amber-400 font-bold uppercase tracking-widest opacity-80">${g.start}â€”${g.end}</div>
                        </div>
                    </button>
                `).join('');
                this.showDossier('millennials');
            },

            showDossier(id) {
                const g = gens.find(x => x.id === id);
                document.getElementById('gen-detail').innerHTML = `
                    <div class="animate-in relative z-10">
                        <div class="flex flex-wrap items-center justify-between gap-6 mb-12 pb-8 border-b border-white/5">
                            <div class="flex items-center gap-8">
                                <div class="w-24 h-24 rounded-[2rem] bg-amber-400 flex items-center justify-center text-5xl shadow-2xl shadow-amber-400/30 text-slate-950">${g.icon}</div>
                                <div>
                                    <h2 class="text-5xl font-black text-white tracking-tighter">${g.name}</h2>
                                    <p class="text-amber-400 font-black uppercase tracking-[0.3em] text-[10px]">Temporal Cluster ${g.start}</p>
                                </div>
                            </div>
                            <div class="px-8 py-3 rounded-2xl bg-white/5 border border-white/10 text-2xl font-mono text-slate-300 font-bold tracking-tighter">${g.start} â€” ${g.end}</div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                            <div class="space-y-8">
                                <div>
                                    <h4 class="text-[10px] font-black text-slate-500 uppercase tracking-[0.2em] mb-4">Psychographic Profile</h4>
                                    <p class="text-slate-300 text-xl leading-relaxed font-medium">The ${g.name} represents a fundamental pivot in the generational wheel. Born into the ${g.id === 'lost' || g.id === 'greatest' ? 'industrial' : 'information'} era, their values were forged by systemic shifts in global communication and economic stability.</p>
                                </div>
                                <div class="flex gap-3">
                                    <span class="px-4 py-2 bg-amber-400/10 rounded-xl text-xs font-black text-amber-400 border border-amber-400/20">RESILIENT</span>
                                    <span class="px-4 py-2 bg-indigo-500/10 rounded-xl text-xs font-black text-indigo-400 border border-indigo-500/20">ADAPTIVE</span>
                                    <span class="px-4 py-2 bg-emerald-500/10 rounded-xl text-xs font-black text-emerald-400 border border-emerald-500/20">TRANSFORMATIVE</span>
                                </div>
                            </div>
                            <div class="p-10 rounded-[3rem] bg-gradient-to-br from-indigo-500/10 to-transparent border border-white/5">
                                <h4 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-6">Era Impact Score</h4>
                                <div class="space-y-4">
                                    <div class="h-2 w-full bg-white/5 rounded-full"><div class="h-full bg-indigo-500 rounded-full" style="width: 85%"></div></div>
                                    <p class="text-slate-400 text-sm italic leading-relaxed">"This cohort navigated the peak of their era's technological curve, leaving a legacy of structural reform that dictates how the following generations interact with institutional power."</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="absolute -bottom-20 -right-20 w-64 h-64 bg-amber-400 opacity-[0.03] rounded-full blur-3xl"></div>
                `;
            },

            initTimeline() {
                const ctx = document.getElementById('timelineChart').getContext('2d');
                this.state.charts.timeline = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: gens.map(g => g.name),
                        datasets: [{
                            data: gens.map(g => [g.start, g.end]),
                            backgroundColor: gens.map(g => g.color + '22'),
                            borderColor: gens.map(g => g.color),
                            borderWidth: 2,
                            borderRadius: 12,
                            borderSkipped: false
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { min: 1880, max: 2030, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#64748b', font: { weight: 'bold' } } },
                            y: { grid: { display: false }, ticks: { color: '#f8fafc', font: { weight: 'bold', size: 10 } } }
                        },
                        onClick: (e, el) => { if(el.length) this.showDossier(gens[el[0].index].id); }
                    }
                });
            },

            // --- QUIZ LOGIC ---
            startQuiz() {
                const checked = Array.from(document.querySelectorAll('.gen-checkbox:checked')).map(c => c.value);
                if(checked.length === 0) return;

                this.state.quiz = {
                    active: true, score: 0, history: [],
                    currentDiff: 0, qIdx: 0, total: 15,
                    usedIds: [], mastery: {}, focus: checked,
                    streak: 0, maxStreak: 0
                };
                
                gens.forEach(g => this.state.quiz.mastery[g.id] = { correct: 0, total: 0 });

                document.getElementById('quiz-setup').classList.add('hidden');
                document.getElementById('quiz-play').classList.remove('hidden');
                document.getElementById('quiz-hud').classList.remove('hidden');
                document.getElementById('quiz-dashboard').classList.add('hidden');
                this.updateHud();
                this.renderQuestion();
            },

            updateHud() {
                document.getElementById('current-score').innerText = this.state.quiz.score;
                document.getElementById('q-status').innerText = `${this.state.quiz.qIdx + 1} / ${this.state.quiz.total}`;
                document.getElementById('progress-bar-inner').style.width = `${(this.state.quiz.qIdx / this.state.quiz.total) * 100}%`;
                
                // Difficulty Pills
                for(let i=0; i<=3; i++) {
                    const p = document.getElementById(`pill-${i}`);
                    p.className = `w-3 h-3 rounded-full progression-pill ${i <= this.state.quiz.currentDiff ? 'active-pill' : 'bg-slate-800'}`;
                }

                // Streak UI
                const streakEl = document.getElementById('streak-counter');
                if(this.state.quiz.streak >= 2) {
                    streakEl.innerText = `STREAK x${this.state.quiz.streak}`;
                    streakEl.classList.remove('hidden');
                    streakEl.classList.add('streak-badge');
                } else {
                    streakEl.classList.add('hidden');
                }
            },

            renderQuestion() {
                let basePool = questions.filter(q => this.state.quiz.focus.includes(q.gen));
                let available = basePool.filter(q => !this.state.quiz.usedIds.includes(q.q));
                
                // Attempt exact difficulty first
                let finalPool = available.filter(q => q.diff === this.state.quiz.currentDiff);
                
                // If not found, try +/- 1 difficulty
                if(finalPool.length === 0) {
                    finalPool = available.filter(q => Math.abs(q.diff - this.state.quiz.currentDiff) <= 1);
                }

                // Ultimate fallback
                if(finalPool.length === 0) finalPool = available;

                const q = finalPool[Math.floor(Math.random() * finalPool.length)];
                this.state.quiz.currentQ = q;
                this.state.quiz.usedIds.push(q.q);

                document.getElementById('q-text').innerText = q.q;
                document.getElementById('q-feedback').classList.add('hidden');
                
                const labels = ["General Info", "Historical Trivia", "Psychographics", "Advanced Theory"];
                document.getElementById('difficulty-badge').innerText = labels[q.diff];
                
                const optContainer = document.getElementById('q-options');
                optContainer.innerHTML = q.options.map((o, i) => `
                    <button onclick="app.checkAnswer(${i})" class="opt-btn group p-8 rounded-3xl glass glass-hover text-left font-bold transition-all border-2 border-white/5 hover:border-amber-400">
                        <div class="flex justify-between items-center">
                            <span>${o}</span>
                            <span class="opacity-0 group-hover:opacity-100 transition-opacity text-amber-400">âž”</span>
                        </div>
                    </button>
                `).join('');
            },

            checkAnswer(idx) {
                const q = this.state.quiz.currentQ;
                const isCorrect = idx === q.correct;
                const btns = document.querySelectorAll('.opt-btn');
                
                btns.forEach(b => b.disabled = true);
                this.state.quiz.mastery[q.gen].total++;
                
                if(isCorrect) {
                    this.state.quiz.streak++;
                    if(this.state.quiz.streak > this.state.quiz.maxStreak) this.state.quiz.maxStreak = this.state.quiz.streak;
                    
                    // Point Scaling: Base (100-300) + Streak Bonus
                    let points = (100 + (q.diff * 60));
                    if(this.state.quiz.streak >= 3) points *= 1.5;
                    
                    this.state.quiz.score += Math.round(points);
                    this.state.quiz.mastery[q.gen].correct++;
                    
                    if(this.state.quiz.currentDiff < 3) this.state.quiz.currentDiff++;
                    this.showFeedback(true, "Analysis Correct", q.exp);
                    btns[idx].classList.add('border-green-500', 'bg-green-500/10');
                } else {
                    this.state.quiz.streak = 0;
                    if(this.state.quiz.currentDiff > 0) this.state.quiz.currentDiff--;
                    this.showFeedback(false, "System Error", q.exp);
                    btns[idx].classList.add('border-red-500', 'bg-red-500/10');
                    btns[q.correct].classList.add('border-green-500/50');
                }

                this.state.quiz.history.push({ 
                    q: q.q, 
                    correct: isCorrect, 
                    exp: q.exp, 
                    userVal: q.options[idx], 
                    correctVal: q.options[q.correct] 
                });
                this.updateHud();
            },

            showFeedback(isCorrect, title, desc) {
                const fb = document.getElementById('q-feedback');
                fb.classList.remove('hidden');
                fb.className = `glass p-10 rounded-[3rem] animate-in border-l-8 ${isCorrect ? 'border-green-500' : 'border-red-500'}`;
                document.getElementById('fb-icon').innerText = isCorrect ? 'ðŸŽ¯' : 'âš ï¸';
                document.getElementById('fb-title').innerText = title;
                document.getElementById('fb-title').className = `text-2xl font-black mb-3 uppercase tracking-tight ${isCorrect ? 'text-green-500' : 'text-red-500'}`;
                document.getElementById('fb-desc').innerText = desc;
            },

            nextQuestion() {
                this.state.quiz.qIdx++;
                if(this.state.quiz.qIdx >= this.state.quiz.total) this.renderDashboard();
                else this.renderQuestion();
            },

            renderDashboard() {
                this.state.quiz.active = false;
                document.getElementById('quiz-play').classList.add('hidden');
                document.getElementById('quiz-hud').classList.add('hidden');
                document.getElementById('quiz-dashboard').classList.remove('hidden');

                const correctCount = this.state.quiz.history.filter(h => h.correct).length;
                document.getElementById('dash-score').innerText = this.state.quiz.score.toLocaleString();
                document.getElementById('dash-accuracy').innerText = Math.round((correctCount/this.state.quiz.total)*100) + '%';
                document.getElementById('dash-streak').innerText = this.state.quiz.maxStreak;

                this.initMasteryChart();

                const list = document.getElementById('review-list');
                list.innerHTML = this.state.quiz.history.map(h => `
                    <div class="p-8 rounded-[2rem] border-2 ${h.correct ? 'border-green-500/10 bg-green-500/5' : 'border-red-500/10 bg-red-500/5'} transition-all hover:scale-[1.02]">
                        <div class="flex justify-between items-start mb-6">
                            <h5 class="font-bold text-white text-lg leading-tight pr-4">${h.q}</h5>
                            <span class="shrink-0 text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${h.correct ? 'bg-green-500 text-slate-950' : 'bg-red-500 text-white'}">${h.correct ? 'PASS' : 'FAIL'}</span>
                        </div>
                        <div class="space-y-4">
                            <p class="text-sm text-slate-500">Selected: <span class="${h.correct ? 'text-green-400' : 'text-red-400'} font-bold">${h.userVal}</span></p>
                            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                                <p class="text-sm text-slate-300 leading-relaxed italic">"${h.exp}"</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            initMasteryChart() {
                const ctx = document.getElementById('masteryChart').getContext('2d');
                if(this.state.charts.mastery) this.state.charts.mastery.destroy();

                const activeGens = gens.filter(g => this.state.quiz.focus.includes(g.id));
                const labels = activeGens.map(g => g.name);
                const data = activeGens.map(g => {
                    const stats = this.state.quiz.mastery[g.id];
                    return stats.total === 0 ? 0 : Math.round((stats.correct / stats.total) * 100);
                });

                this.state.charts.mastery = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Mastery Level',
                            data: data,
                            backgroundColor: 'rgba(251, 191, 36, 0.15)',
                            borderColor: '#fbbf24',
                            pointBackgroundColor: '#fbbf24',
                            borderWidth: 4,
                            pointRadius: 4
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            r: {
                                grid: { color: 'rgba(255,255,255,0.08)' },
                                angleLines: { color: 'rgba(255,255,255,0.08)' },
                                ticks: { display: false },
                                pointLabels: { color: '#94a3b8', font: { size: 11, weight: '900' } },
                                min: 0, max: 100
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>
