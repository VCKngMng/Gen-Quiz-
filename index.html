<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenExpert Pro | Intelligence Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --accent: #fbbf24;
            --accent-glow: rgba(251, 191, 36, 0.4);
            --bg-deep: #020617;
            --success: #22c55e;
            --error: #ef4444;
        }

        body { background-color: var(--bg-deep); color: #f8fafc; overflow-x: hidden; }
        .glass { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        .archive-sidebar-item { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .archive-sidebar-item:hover { transform: translateX(8px); }

        .gen-checkbox:checked + label { 
            background: var(--accent); 
            color: #020617; 
            border-color: var(--accent);
            box-shadow: 0 4px 12px var(--accent-glow);
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.98) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-content { animation: fadeInScale 0.4s ease-out forwards; }

        .review-card-ok { border-left: 4px solid var(--success); background: rgba(34, 197, 94, 0.05); }
        .review-card-err { border-left: 4px solid var(--error); background: rgba(239, 68, 68, 0.05); }
    </style>
</head>
<body class="font-sans antialiased">

    <nav class="sticky top-0 z-50 border-b border-white/5 bg-slate-950/90 backdrop-blur-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="app.switchTab('home')">
                <div class="w-10 h-10 bg-amber-400 rounded-xl flex items-center justify-center text-slate-950 font-black text-xl shadow-lg shadow-amber-400/20">G</div>
                <span class="text-2xl font-black tracking-tighter text-white uppercase italic">Gen<span class="text-amber-400">Expert</span></span>
            </div>
            <div class="flex gap-2">
                <button onclick="app.switchTab('explore')" id="nav-explore" class="px-5 py-2 rounded-xl text-sm font-black transition-all">Archive</button>
                <button onclick="app.switchTab('quiz')" id="nav-quiz" class="px-5 py-2 bg-amber-400 text-slate-950 rounded-xl text-sm font-black transition-all">Training</button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- HOME VIEW -->
        <section id="view-home" class="py-20 text-center animate-content">
            <h1 class="text-6xl md:text-8xl font-black mb-8 tracking-tighter leading-[0.9]">Master the <br><span class="text-amber-400">Generational Code.</span></h1>
            <p class="text-slate-400 text-xl max-w-2xl mx-auto mb-12">An interactive vault exploring the sociological shifts of the last 150 years.</p>
            <div class="flex flex-wrap gap-4 justify-center">
                <button onclick="app.switchTab('explore')" class="px-10 py-5 glass hover:border-amber-400 rounded-2xl font-black text-lg transition-all">Enter Archive</button>
                <button onclick="app.switchTab('quiz')" class="px-10 py-5 bg-white text-slate-950 rounded-2xl font-black text-lg hover:bg-amber-400 transition-all">Start Training</button>
            </div>
        </section>

        <!-- ARCHIVE VIEW -->
        <section id="view-explore" class="hidden animate-content">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <div class="lg:col-span-3 space-y-4">
                    <div class="glass p-6 rounded-[2rem] border-white/5">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-[10px] font-black uppercase text-slate-500">Archive Progress</span>
                            <span id="discovery-percent" class="text-xs font-black text-amber-400">0%</span>
                        </div>
                        <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                            <div id="discovery-bar" class="h-full bg-amber-400 transition-all duration-700 w-0"></div>
                        </div>
                    </div>
                    <div class="space-y-2 max-h-[60vh] overflow-y-auto hide-scroll pr-2" id="archive-sidebar"></div>
                </div>

                <div class="lg:col-span-9 space-y-6">
                    <div class="glass p-6 rounded-[2.5rem] border-white/5 relative overflow-hidden h-32">
                        <canvas id="timelineChart"></canvas>
                    </div>
                    <div id="archive-detail-container" class="space-y-6"></div>
                </div>
            </div>
        </section>

        <!-- QUIZ VIEW -->
        <section id="view-quiz" class="hidden animate-content">
            <div class="max-w-4xl mx-auto">
                <div id="quiz-setup" class="glass p-12 rounded-[3rem] border-white/5">
                    <div class="text-center mb-10">
                        <h2 class="text-4xl font-black mb-3 italic uppercase tracking-tighter text-white">Assessment Config</h2>
                        <p class="text-slate-500">Toggle generations to build your custom training pool.</p>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-12" id="focus-options"></div>
                    <div class="flex justify-center">
                        <button onclick="app.startQuiz()" class="bg-amber-400 text-slate-950 px-16 py-5 rounded-2xl font-black text-xl hover:scale-105 transition-all shadow-xl shadow-amber-400/20">Initialize Sequence</button>
                    </div>
                </div>

                <div id="quiz-hud" class="hidden grid grid-cols-3 gap-4 mb-6">
                    <div class="glass p-5 rounded-3xl text-center border-white/5">
                        <span class="text-[10px] uppercase text-slate-500 font-black block mb-1">Score</span>
                        <span id="current-score" class="text-2xl font-black text-amber-400">0</span>
                    </div>
                    <div class="glass p-5 rounded-3xl text-center border-white/5">
                        <span class="text-[10px] uppercase text-slate-500 font-black block mb-1">Difficulty</span>
                        <div class="flex justify-center gap-1.5" id="difficulty-pills"></div>
                    </div>
                    <div class="glass p-5 rounded-3xl text-center border-white/5">
                        <span class="text-[10px] uppercase text-slate-500 font-black block mb-1">Progress</span>
                        <span id="q-status" class="text-2xl font-bold italic">1/15</span>
                    </div>
                </div>

                <div id="quiz-play" class="hidden space-y-6">
                    <div class="glass p-10 rounded-[3.5rem] border-white/10">
                        <span id="difficulty-badge" class="mb-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest block">Level: Basic</span>
                        <h2 id="q-text" class="text-3xl md:text-4xl font-black leading-tight mb-12">...</h2>
                        <div id="q-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                    <div id="q-feedback" class="hidden glass p-10 rounded-[2.5rem] animate-content">
                        <div class="flex gap-8 items-start">
                            <div id="fb-icon" class="text-5xl"></div>
                            <div class="flex-1">
                                <h4 id="fb-title" class="text-xl font-black mb-2 uppercase"></h4>
                                <p id="fb-desc" class="text-slate-400 mb-8 leading-relaxed"></p>
                                <button onclick="app.nextQuestion()" class="bg-amber-400 text-slate-950 px-10 py-3 rounded-xl font-black hover:bg-white transition-all">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="quiz-dashboard" class="hidden space-y-8 animate-content">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-1 glass p-10 rounded-[3rem] border-amber-400/20 text-center">
                            <h3 class="text-xs font-black mb-8 uppercase text-slate-500">Assessment Results</h3>
                            <p class="text-7xl font-black text-amber-400 mb-6" id="dash-score">0</p>
                            <div class="grid grid-cols-2 gap-4 mb-10 pt-6 border-t border-white/5">
                                <div><p class="text-[10px] text-slate-500 font-black mb-1 uppercase">Accuracy</p><p id="dash-accuracy" class="text-2xl font-bold">0%</p></div>
                                <div><p class="text-[10px] text-slate-500 font-black mb-1 uppercase">Streak</p><p id="dash-streak" class="text-2xl font-bold">0</p></div>
                            </div>
                            <div class="space-y-3">
                                <button onclick="app.switchTab('quiz')" class="w-full py-4 bg-amber-400 text-slate-950 rounded-2xl font-black">New Training</button>
                                <button onclick="app.switchTab('explore')" class="w-full py-4 glass text-white rounded-2xl font-black">Archive</button>
                            </div>
                        </div>
                        <div class="lg:col-span-2 glass p-10 rounded-[3rem] border-white/5 h-[450px]">
                            <h3 class="text-xs font-black uppercase text-slate-500 mb-6">Subject Mastery</h3>
                            <canvas id="masteryChart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <h3 class="text-sm font-black uppercase tracking-widest text-slate-500 ml-4">Detailed Sequence Review</h3>
                        <div id="review-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const gens = [
            { 
                id: 'lost', name: 'Lost Generation', start: 1883, end: 1900, icon: 'ðŸŽ©', color: '#f59e0b', 
                vibe: 'Disillusioned Resilience', 
                summary: 'Born during the shift from Victorian to Industrial, they were marked by the wreckage of WWI.',
                traits: ['Stoic', 'Skeptical', 'Globalist'], 
                impact: 'Modernist literature, Dadaism, and the expatriate cultural identity.',
                economy: 'Transition to Industrial mass production; gold standard.',
                icons: 'Ernest Hemingway, F. Scott Fitzgerald, Gertrude Stein',
                archetype: 'Nomad' 
            },
            { 
                id: 'greatest', name: 'Greatest Generation', start: 1901, end: 1927, icon: 'ðŸŽ–ï¸', color: '#10b981', 
                vibe: 'Civic Sacrifice', 
                summary: 'The GI generation that navigated the Great Depression and fought World War II.',
                traits: ['Dutiful', 'Disciplined', 'Civic-minded'], 
                impact: 'Established the post-WWII global institutions and the modern middle class.',
                economy: 'Depression era followed by massive post-war industrial expansion.',
                icons: 'John F. Kennedy, Rosa Parks, James Stewart',
                archetype: 'Hero' 
            },
            { 
                id: 'silent', name: 'Silent Generation', start: 1928, end: 1945, icon: 'ðŸ“»', color: '#6366f1', 
                vibe: 'Adaptive Conformity', 
                summary: 'Born into hardship, they became the bridge to the post-war boom, often working within systems.',
                traits: ['Cautious', 'Prudent', 'Collaborative'], 
                impact: 'The Civil Rights Movement and the "Corporate Man" management style.',
                economy: 'War-time recovery and the start of the "Golden Age" of Capitalism.',
                icons: 'Martin Luther King Jr., Bob Dylan, Gloria Steinem',
                archetype: 'Artist' 
            },
            { 
                id: 'boomers', name: 'Baby Boomers', start: 1946, end: 1964, icon: 'â˜®ï¸', color: '#ec4899', 
                vibe: 'Idealistic Expansion', 
                summary: 'The post-war birth explosion. They transformed culture through rights movements and consumption.',
                traits: ['Ambitious', 'Individualistic', 'Competitive'], 
                impact: 'Redefined personal identity, popularized counter-culture, and dominated wealth for decades.',
                economy: 'The rise of the consumer economy and globalization.',
                icons: 'Steve Jobs, Oprah Winfrey, Bill Clinton',
                archetype: 'Prophet' 
            },
            { 
                id: 'genx', name: 'Gen X', start: 1965, end: 1980, icon: 'ðŸ“¼', color: '#f43f5e', 
                vibe: 'Cynical Independence', 
                summary: 'The Latchkey Kids. Pragmatic, self-reliant, and skeptical of institutional authority.',
                traits: ['Pragmatic', 'Entrepreneurial', 'Resourceful'], 
                impact: 'Fueled the dot-com revolution and pushed for work-life balance.',
                economy: 'Stagflation followed by the 80s boom and the birth of Silicon Valley.',
                icons: 'Kurt Cobain, Elon Musk, Jennifer Aniston',
                archetype: 'Nomad' 
            },
            { 
                id: 'millennials', name: 'Millennials', start: 1981, end: 1996, icon: 'ðŸ’¾', color: '#8b5cf6', 
                vibe: 'Digital Connectivity', 
                summary: 'The first to grow up with the internet. Purpose-driven and collaborative.',
                traits: ['Tech-savvy', 'Optimistic', 'Purpose-oriented'], 
                impact: 'The sharing economy (Uber/Airbnb) and the shift to remote work.',
                economy: 'The Great Recession and the rise of the gig economy.',
                icons: 'Mark Zuckerberg, Taylor Swift, Malala Yousafzai',
                archetype: 'Hero' 
            },
            { 
                id: 'genz', name: 'Gen Z', start: 1997, end: 2012, icon: 'ðŸ“±', color: '#06b6d4', 
                vibe: 'Fluid Authenticity', 
                summary: 'Digital natives. Hyper-connected, socially conscious, and pragmatic about the future.',
                traits: ['Diverse', 'Inclusive', 'Radically honest'], 
                impact: 'Creator economy, mental health awareness, and climate activism.',
                economy: 'Subscription-based models and the influence of social-commerce.',
                icons: 'Greta Thunberg, Zendaya, MrBeast',
                archetype: 'Artist' 
            },
            { 
                id: 'alpha', name: 'Gen Alpha', start: 2013, end: 2025, icon: 'ðŸ¤–', color: '#14b8a6', 
                vibe: 'Immersive Integration', 
                summary: 'Entirely born in the 21st century. AI and tablets are their baseline reality.',
                traits: ['Adaptive', 'AI-native', 'Globally connected'], 
                impact: 'Expected to be the most educated and tech-integrated generation ever.',
                economy: 'Transitioning to AI-driven economies and decentralized finance.',
                icons: 'N/A (Current Youth)',
                archetype: 'Prophet' 
            }
        ];

        const questions = [
            { q: "Which group is famously called 'The Latchkey Kids'?", options: ["Boomers", "Gen X", "Millennials", "Gen Z"], correct: 1, diff: 0, gen: 'genx', exp: "High rates of dual-income parents meant many Gen Xers came home to empty houses." },
            { q: "The 'GI Generation' refers to which cohort?", options: ["Lost", "Greatest", "Silent", "Boomers"], correct: 1, diff: 0, gen: 'greatest', exp: "Named for the millions of 'GIs' who fought in WWII." },
            { q: "Standard transition year between Millennial and Gen Z?", options: ["1994", "1996", "1998", "2000"], correct: 1, diff: 1, gen: 'millennials', exp: "1996 is the widely accepted sociological cutoff." },
            { q: "Which gen is currently the most diverse in US history?", options: ["Millennials", "Gen Z", "Gen X", "Alpha"], correct: 1, diff: 2, gen: 'genz', exp: "Gen Z's metrics for racial and ethnic diversity are the highest recorded." },
            { q: "Who popularized the name 'Generation X' via a 1991 novel?", options: ["Hemingway", "Douglas Coupland", "Chuck Palahniuk", "Bret Easton Ellis"], correct: 1, diff: 2, gen: 'genx', exp: "Coupland's 'Generation X: Tales for an Accelerated Culture' defined the name." },
            { q: "Which generation is characterized by the 'Artist' archetype?", options: ["Silent", "Boomers", "Gen X", "Millennials"], correct: 0, diff: 3, gen: 'silent', exp: "Under Strauss-Howe theory, the Silent Generation fits the Artist (receptive) archetype." },
            { q: "Whose phrase 'You are all a lost generation' gave the cohort its name?", options: ["Gertrude Stein", "Ernest Hemingway", "Sylvia Plath", "James Joyce"], correct: 0, diff: 2, gen: 'lost', exp: "Gertrude Stein said this to Hemingway, who then used it in 'The Sun Also Rises'." },
            { q: "Which group dominates the 'sharing economy' disruption?", options: ["Gen X", "Millennials", "Gen Z", "Boomers"], correct: 1, diff: 1, gen: 'millennials', exp: "Millennials were the primary early adopters and creators of platforms like Uber and Airbnb." },
            { q: "The 'Echo Boomer' moniker describes which generation?", options: ["Gen X", "Millennials", "Gen Z", "Alpha"], correct: 1, diff: 1, gen: 'millennials', exp: "They are the 'echo' of their Baby Boomer parents." },
            { q: "Which group came of age during the 2008 Financial Crisis?", options: ["Gen X", "Millennials", "Gen Z", "Boomers"], correct: 1, diff: 0, gen: 'millennials', exp: "This crisis deeply shaped Millennial career paths and financial views." },
            { q: "Which group is defined by coming of age in the 1960s?", options: ["Silent", "Boomers", "Gen X", "Greatest"], correct: 1, diff: 0, gen: 'boomers', exp: "Boomers are synonymous with the cultural shifts of the 1960s." },
            { q: "Gen Alpha are primarily the children of...?", options: ["Gen X", "Millennials", "Gen Z", "Silent"], correct: 1, diff: 1, gen: 'alpha', exp: "Millennials are the primary parents of the Alpha cohort." },
            { q: "Which group produced no US Presidents until Biden?", options: ["Lost", "Greatest", "Silent", "Boomers"], correct: 2, diff: 3, gen: 'silent', exp: "The Silent Generation was historically 'skipped' for the presidency until Joe Biden (born 1942)." },
            { q: "Which generation is first born into a world of Generative AI?", options: ["Gen Z", "Alpha", "Beta", "Millennials"], correct: 1, diff: 1, gen: 'alpha', exp: "Alpha's infancy coincides with the global explosion of Large Language Models." },
            { q: "Which generation pioneered 'Work-Life Balance' as a corporate concept?", options: ["Boomers", "Gen X", "Millennials", "Gen Z"], correct: 1, diff: 2, gen: 'genx', exp: "Gen X pushed back against the 'workaholic' Boomer culture." }
        ];

        const app = {
            state: {
                viewed: new Set(),
                quiz: { active: false, score: 0, history: [], qIdx: 0, total: 15, used: [], streak: 0, maxStreak: 0, diff: 0, focus: [] }
            },

            init() {
                this.renderArchiveSidebar();
                this.renderFocusOptions();
                this.initTimeline();
                this.showGenDetail('millennials');
            },

            switchTab(tab) {
                ['home', 'explore', 'quiz'].forEach(t => document.getElementById(`view-${t}`).classList.add('hidden'));
                document.getElementById(`view-${tab}`).classList.remove('hidden');
                ['explore', 'quiz'].forEach(t => {
                    const btn = document.getElementById(`nav-${t}`);
                    btn.className = (tab === t) ? "px-5 py-2 bg-white/10 text-white rounded-xl text-sm font-black" : "px-5 py-2 rounded-xl text-sm font-black text-slate-400 hover:text-white";
                });
                if(tab === 'quiz') this.resetToSetup();
                window.scrollTo(0,0);
            },

            resetToSetup() {
                this.state.quiz.active = false;
                document.getElementById('quiz-setup').classList.remove('hidden');
                document.getElementById('quiz-play').classList.add('hidden');
                document.getElementById('quiz-hud').classList.add('hidden');
                document.getElementById('quiz-dashboard').classList.add('hidden');
            },

            renderArchiveSidebar() {
                const list = document.getElementById('archive-sidebar');
                list.innerHTML = gens.map(g => `
                    <button onclick="app.showGenDetail('${g.id}')" id="side-${g.id}" class="archive-sidebar-item w-full p-4 glass rounded-2xl flex items-center gap-4 text-left border-white/5">
                        <span class="text-2xl">${g.icon}</span>
                        <div class="overflow-hidden">
                            <div class="text-xs font-black text-white truncate">${g.name}</div>
                            <div class="text-[8px] font-bold text-slate-500 uppercase">${g.start}â€”${g.end}</div>
                        </div>
                    </button>
                `).join('');
            },

            showGenDetail(id) {
                this.state.viewed.add(id);
                gens.forEach(g => {
                    document.getElementById(`side-${g.id}`).classList.toggle('border-amber-400', g.id === id);
                    document.getElementById(`side-${g.id}`).classList.toggle('bg-amber-400/5', g.id === id);
                });
                const p = Math.round((this.state.viewed.size / gens.length) * 100);
                document.getElementById('discovery-percent').innerText = p + '%';
                document.getElementById('discovery-bar').style.width = p + '%';

                const g = gens.find(x => x.id === id);
                document.getElementById('archive-detail-container').innerHTML = `
                    <div class="animate-content grid grid-cols-1 md:grid-cols-12 gap-6">
                        <div class="md:col-span-8 glass p-10 rounded-[3rem] border-white/5 relative overflow-hidden">
                            <div class="relative z-10">
                                <h2 class="text-5xl font-black italic mb-2 tracking-tighter">${g.name}</h2>
                                <p class="text-[10px] font-black uppercase text-amber-400 mb-8 tracking-[0.3em]">Era Mood: ${g.vibe}</p>
                                <p class="text-xl text-slate-300 leading-relaxed mb-10">"${g.summary}"</p>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-8 pt-8 border-t border-white/5">
                                    <div>
                                        <h4 class="text-[9px] font-black uppercase text-slate-500 mb-4 tracking-widest">Global Impact</h4>
                                        <p class="text-sm font-medium leading-relaxed">${g.impact}</p>
                                    </div>
                                    <div>
                                        <h4 class="text-[9px] font-black uppercase text-slate-500 mb-4 tracking-widest">Economic Context</h4>
                                        <p class="text-sm font-medium leading-relaxed">${g.economy}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="absolute -bottom-10 -right-10 text-[15rem] opacity-[0.03] select-none">${g.icon}</div>
                        </div>

                        <div class="md:col-span-4 space-y-6">
                            <div class="glass p-8 rounded-[2.5rem] border-white/5">
                                <h4 class="text-[9px] font-black uppercase text-slate-500 mb-6 tracking-widest">Cultural Icons</h4>
                                <p class="text-xs italic text-slate-300 leading-loose">${g.icons}</p>
                            </div>
                            <div class="glass p-8 rounded-[2.5rem] border-amber-400/20 bg-amber-400/5">
                                <h4 class="text-[9px] font-black uppercase text-amber-400 mb-4 tracking-widest">Sociological Archetype</h4>
                                <div class="flex items-center gap-3">
                                    <div class="w-1.5 h-1.5 rounded-full bg-amber-400 shadow-[0_0_8px_var(--accent)]"></div>
                                    <span class="text-lg font-black italic">${g.archetype}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            },

            initTimeline() {
                const ctx = document.getElementById('timelineChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: gens.map(g => g.name),
                        datasets: [{ data: gens.map(g => [g.start, g.end]), backgroundColor: gens.map(g => g.color + '22'), borderColor: gens.map(g => g.color), borderWidth: 2, borderRadius: 10, borderSkipped: false }]
                    },
                    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { min: 1880, max: 2030, grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#475569' } }, y: { display: false } } }
                });
            },

            renderFocusOptions() {
                const container = document.getElementById('focus-options');
                container.innerHTML = gens.map(g => `
                    <div>
                        <input type="checkbox" id="focus-${g.id}" value="${g.id}" class="hidden gen-checkbox" checked>
                        <label for="focus-${g.id}" class="block p-4 rounded-xl border border-white/5 glass cursor-pointer text-[10px] font-black uppercase text-center transition-all hover:border-amber-400">
                            ${g.name}
                        </label>
                    </div>
                `).join('');
            },

            startQuiz() {
                const focus = Array.from(document.querySelectorAll('.gen-checkbox:checked')).map(c => c.value);
                if(focus.length === 0) return;
                this.state.quiz = { active: true, score: 0, history: [], qIdx: 0, total: 15, used: [], streak: 0, maxStreak: 0, diff: 0, focus: focus, mastery: {} };
                gens.forEach(g => this.state.quiz.mastery[g.id] = { c: 0, t: 0 });
                document.getElementById('quiz-setup').classList.add('hidden');
                document.getElementById('quiz-play').classList.remove('hidden');
                document.getElementById('quiz-hud').classList.remove('hidden');
                this.updateHud();
                this.renderQuestion();
            },

            updateHud() {
                document.getElementById('current-score').innerText = Math.round(this.state.quiz.score);
                document.getElementById('q-status').innerText = `${this.state.quiz.qIdx + 1}/15`;
                const p = document.getElementById('difficulty-pills');
                p.innerHTML = [0,1,2,3].map(i => `<div class="w-2.5 h-2.5 rounded-full ${i <= this.state.quiz.diff ? 'bg-amber-400' : 'bg-white/10'}"></div>`).join('');
            },

            renderQuestion() {
                const pool = questions.filter(q => this.state.quiz.focus.includes(q.gen) && !this.state.quiz.used.includes(q.q));
                const source = (pool.length > 0) ? pool : questions.filter(q => this.state.quiz.focus.includes(q.gen));
                const q = source[Math.floor(Math.random() * source.length)];
                this.state.quiz.current = q;
                this.state.quiz.used.push(q.q);
                document.getElementById('q-text').innerText = q.q;
                document.getElementById('q-feedback').classList.add('hidden');
                document.getElementById('difficulty-badge').innerText = `Level ${q.diff} Retrieval`;
                document.getElementById('q-options').innerHTML = q.options.map((o, i) => `
                    <button onclick="app.check(${i})" class="opt-btn p-8 rounded-2xl glass text-left font-bold border border-white/5 hover:border-amber-400 transition-all">
                        ${o}
                    </button>
                `).join('');
            },

            check(idx) {
                const q = this.state.quiz.current;
                const ok = idx === q.correct;
                this.state.quiz.mastery[q.gen].t++;
                if(ok) {
                    this.state.quiz.streak++;
                    if(this.state.quiz.streak > this.state.quiz.maxStreak) this.state.quiz.maxStreak = this.state.quiz.streak;
                    this.state.quiz.score += (100 + (q.diff * 50)) * (this.state.quiz.streak > 2 ? 1.5 : 1);
                    this.state.quiz.mastery[q.gen].c++;
                    if(this.state.quiz.diff < 3) this.state.quiz.diff++;
                    this.showFeedback(true, "Correct Selection", q.exp);
                } else {
                    this.state.quiz.streak = 0;
                    if(this.state.quiz.diff > 0) this.state.quiz.diff--;
                    this.showFeedback(false, "Desync Error", q.exp);
                }
                document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
                this.state.quiz.history.push({ q: q.q, ok: ok, exp: q.exp, ans: q.options[q.correct], userAns: q.options[idx] });
                this.updateHud();
            },

            showFeedback(ok, title, desc) {
                const fb = document.getElementById('q-feedback');
                fb.classList.remove('hidden');
                fb.style.borderColor = ok ? '#22c55e' : '#ef4444';
                document.getElementById('fb-icon').innerText = ok ? 'ðŸŽ¯' : 'âŒ';
                document.getElementById('fb-title').innerText = title;
                document.getElementById('fb-title').className = `text-xl font-black mb-2 uppercase ${ok ? 'text-green-400' : 'text-red-400'}`;
                document.getElementById('fb-desc').innerText = desc;
            },

            nextQuestion() {
                this.state.quiz.qIdx++;
                if(this.state.quiz.qIdx >= this.state.quiz.total) this.finish();
                else this.renderQuestion();
            },

            finish() {
                document.getElementById('quiz-play').classList.add('hidden');
                document.getElementById('quiz-hud').classList.add('hidden');
                document.getElementById('quiz-dashboard').classList.remove('hidden');
                document.getElementById('dash-score').innerText = Math.round(this.state.quiz.score);
                const acc = Math.round((this.state.quiz.history.filter(h => h.ok).length / 15) * 100);
                document.getElementById('dash-accuracy').innerText = acc + '%';
                document.getElementById('dash-streak').innerText = this.state.quiz.maxStreak;
                this.initMasteryChart();
                
                document.getElementById('review-list').innerHTML = this.state.quiz.history.map(h => `
                    <div class="p-6 rounded-2xl ${h.ok ? 'review-card-ok' : 'review-card-err'} transition-all hover:scale-[1.01]">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="${h.ok ? 'text-green-400' : 'text-red-400'} text-xs font-black uppercase tracking-widest">
                                ${h.ok ? 'Success' : 'Incorrect'}
                            </span>
                        </div>
                        <p class="text-sm font-bold text-white mb-3">${h.q}</p>
                        ${!h.ok ? `<p class="text-[10px] text-red-300 line-through opacity-60 mb-1">Your choice: ${h.userAns}</p>` : ''}
                        <p class="text-[10px] text-green-400 font-black mb-3 uppercase">Correct Answer: ${h.ans}</p>
                        <p class="text-[11px] text-slate-400 italic leading-relaxed bg-black/20 p-3 rounded-lg border border-white/5">"${h.exp}"</p>
                    </div>
                `).join('');
            },

            initMasteryChart() {
                const ctx = document.getElementById('masteryChart').getContext('2d');
                const focusGens = gens.filter(g => this.state.quiz.focus.includes(g.id));
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: focusGens.map(g => g.name),
                        datasets: [{
                            data: focusGens.map(g => {
                                const s = this.state.quiz.mastery[g.id];
                                return s.t === 0 ? 0 : Math.round((s.c/s.t)*100);
                            }),
                            borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.1)', borderWidth: 2, pointBackgroundColor: '#fbbf24'
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { r: { grid: { color: 'rgba(255,255,255,0.05)' }, angleLines: { color: 'rgba(255,255,255,0.05)' }, ticks: { display: false }, pointLabels: { color: '#94a3b8', font: { size: 10, weight: 'bold' } } } }, plugins: { legend: { display: false } } }
                });
            }
        };

        window.onload = () => app.init();
    </script>
</body>
</html>
